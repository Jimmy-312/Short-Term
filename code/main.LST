C51 COMPILER V9.01   MAIN                                                                  07/20/2021 16:33:21 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h>
   2          #include<intrins.h>
   3          #define uint unsigned int
   4          #define uchar unsigned char
   5          
   6          sbit RES=P0^0;
   7          sbit LCDE=P1^0;
   8          sbit RW=P1^1;
   9          sbit RS=P1^2;
  10          sbit SCL=P1^3;
  11          sbit SDA=P1^4;
  12          sbit SA=P1^5;
  13          sbit LED=P1^6;
  14          sbit BUZZ=P1^7;
  15          
  16          void delay(uint i);
  17          void send_bit(uchar dat);
  18          uchar read_bit(void);
  19          uchar ReadByte(void);
  20          void start(void);
  21          void stop(void);
  22          uint getTemp(void);
  23          void busy(void);
  24          void cmd_w(uchar cmd);
  25          void init1602(void);
  26          
  27          void main()
  28          {
  29   1              //send_bit(1);
  30   1      }
  31          
  32          void delay(uint n)
  33          {
  34   1              uint i;
  35   1              for(i=0;i<n;i++)
  36   1              {
  37   2                      _nop_();
  38   2              }
  39   1      }
  40          
  41          void send_bit(uchar dat)
  42          {
  43   1              SDA=dat;                                                                         
  44   1              _nop_();
  45   1              SCL=1;                                                           
  46   1              delay(8);
  47   1              SCL=0;
  48   1              delay(8);
  49   1      }
  50          
  51          uchar read_bit(void)
  52          {
  53   1              uchar rdata;
  54   1              SDA=1;                                                 
  55   1              SCL=1;                                                   
C51 COMPILER V9.01   MAIN                                                                  07/20/2021 16:33:21 PAGE 2   

  56   1              delay(8);
  57   1              rdata=SDA;                                             
  58   1              _nop_();
  59   1              SCL=0;
  60   1              delay(8);
  61   1              return rdata;
  62   1      }
  63          
  64          void SendByte(uchar dat)
  65          {
  66   1          uchar i,n=2,rdata;                                               
  67   1              Send:
  68   1              for(i=0;i<8;i++)                                       
  69   1              {                                  
  70   2                      send_bit(dat&0x80);                                            
  71   2                      dat=dat<<1;                                            
  72   2              }
  73   1              rdata=read_bit();                                                  
  74   1              if(rdata==1)                                          
  75   1              {
  76   2                      stop();
  77   2                      if(n!=0)
  78   2                      {
  79   3                              n--;                                            
  80   3                              goto Repeat;                                     
  81   3                      }  
  82   2          }
  83   1              goto Exit;
  84   1              Repeat:
  85   1              start();                                                      
  86   1              goto Send;                                              
  87   1              Exit: ;                                                        
  88   1      }
  89          
  90          uchar ReadByte(void)
  91          {
  92   1              uchar i,dat,rbit;
  93   1              dat=0;                                                        
  94   1              for(i=0;i<8;i++)
  95   1              {
  96   2                      dat=dat<<1;                                                  
  97   2                      rbit=read_bit();                                                 
  98   2                      dat+=rbit;                                           
  99   2              }                                                   
 100   1              send_bit(0);
 101   1              return dat;                                              
 102   1      }
 103          
 104          void start(void)                                        
 105          {
 106   1              SDA=1;
 107   1              delay(4);
 108   1              SCL=1;
 109   1              delay(4);
 110   1              SDA=0;
 111   1              delay(4);
 112   1              SCL=0;
 113   1              delay(4);
 114   1      }
 115          
 116          void stop(void)                                               
 117          {
C51 COMPILER V9.01   MAIN                                                                  07/20/2021 16:33:21 PAGE 3   

 118   1              SCL=0;
 119   1              delay(4);
 120   1              SDA=0;
 121   1              delay(4);
 122   1              SCL=1;
 123   1              delay(4);
 124   1              SDA=1;
 125   1      }
 126          
 127          uint getTemp(void)
 128          {
 129   1              uchar tempL,tempH,error;
 130   1              SCL=0;
 131   1              start();
 132   1              SendByte(0x00); //Send address, default:0x00;
 133   1              SendByte(0x07);
 134   1              start();
 135   1              SendByte(0x01);
 136   1              tempL=ReadByte();
 137   1              tempH=ReadByte();
 138   1              error=ReadByte();
 139   1              stop();
 140   1              return tempL+tempH*256;
 141   1      }
 142          
 143          void cmd_w(uchar cmd)                                  
 144          {
 145   1              LCDE=0;
 146   1              busy();                                                 
 147   1              P2=cmd;                                                 
 148   1              RS=0;                                                    
 149   1              RW=0;                                                    
 150   1              LCDE=1;                                               
 151   1              LCDE=0;
 152   1      }
 153          
 154          void init1602(void)                            
 155          {
 156   1              cmd_w(0x01);                                 //Clean
 157   1              cmd_w(0x0c);                                 //Inital Settings
 158   1              cmd_w(0x06);
 159   1              cmd_w(0x38);  
 160   1      }
 161                                         
 162          
 163          void busy(void)                                 //LCD is busy ?
 164          {
 165   1              uchar flag=0x80;                                    
 166   1              while(flag&0x80)                          
 167   1              {
 168   2                      P1=0xff;
 169   2                      RS=0;                                               
 170   2                      RW=1;                                             
 171   2                      LCDE=1;                                       
 172   2                      flag=P1;                                       
 173   2                      LCDE=0;
 174   2              }
 175   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    291    ----
C51 COMPILER V9.01   MAIN                                                                  07/20/2021 16:33:21 PAGE 4   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       6
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
